{% extends "base.html" %}
{% block content %}
<section class="panel-card">
  <h2>Movimenta√ß√µes (Todos os Itens)</h2>

  <form method="GET" action="{{ url_for('movimentacoes') }}" class="filter-form"> <label for="user">Usu√°rio:</label> <select name="user"> <option value="">Todos</option> {% for u in users %} <option value="{{ u.username }}" {% if request.args.get('user') == u.username %}selected{% endif %}> {{ u.username }} </option> {% endfor %} </select> <label for="type">Tipo:</label> <select name="type"> <option value="">Todos</option> <option value="Entrada" {% if request.args.get('type') == 'Entrada' %}selected{% endif %}>Entrada</option> <option value="Sa√≠da" {% if request.args.get('type') == 'Sa√≠da' %}selected{% endif %}>Sa√≠da</option> </select> <label for="start">De:</label> <input type="date" name="start" value="{{ request.args.get('start','') }}"> <label for="end">At√©:</label> <input type="date" name="end" value="{{ request.args.get('end','') }}"> <button type="submit">Filtrar</button> </form>

  {% if movements %}
    <div class="table-container">
      <table>
        <thead>
          <tr>
              <th>Data/Hora</th>
              <th>Protocolo</th>
              <th>Descri√ß√£o</th>
              <th>Tipo</th>
              <th>Local</th>
              <th>Nota</th>
              <th>Usu√°rio</th> 
            </tr>
          </thead>
          <tbody>
            {% for mov in movements %}
            <tr>
              <td class="nowrap">{{ mov.created_at.strftime("%d/%m/%Y %H:%M:%S") }}</td>
              <td class="nowrap">{{ mov.protocol }}</td>
              <td>{{ mov.description or '' }}</td>
              <td class="{% if mov.type == 'Entrada' %}entrada{% else %}saida{% endif %}"> {% if mov.type == "Entrada" %} üì• Entrada {% else %} üì§ Sa√≠da {% endif %} </td>
              <td>{{ mov.location }}</td> 
              <td>{{ mov.note or '' }}</td> 
              <td>{{ mov.user }}</td> 
            </tr>
            {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p>Nenhuma movimenta√ß√£o registrada.</p>
  {% endif %}
</section>
{% endblock %}
