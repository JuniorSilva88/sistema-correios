{% extends "base.html" %}

{% block content %}
<section class="panel-card">
  <h2>MovimentaÃ§Ãµes (Todos os Itens)</h2>

  <!-- FormulÃ¡rio de filtros -->
  <form method="GET" action="{{ url_for('movimentacoes') }}" class="filter-form">
    <label for="usuario">UsuÃ¡rio:</label>
    <select name="usuario" id="usuario">
      <option value="">Todos</option>
      {% for user in users %}
        <option value="{{ user }}" {% if request.args.get('usuario') == user %}selected{% endif %}>
          {{ user }}
        </option>
      {% endfor %}
    </select>

    <label for="tipo">Tipo:</label>
    <select name="tipo" id="tipo">
      <option value="" {% if not request.args.get('tipo') %}selected{% endif %}>Todos</option>
      <option value="entrada" {% if request.args.get('tipo') == 'entrada' %}selected{% endif %}>Entrada</option>
      <option value="saida" {% if request.args.get('tipo') == 'saida' %}selected{% endif %}>SaÃ­da</option>
    </select>

    <label for="data_inicio">De:</label>
    <input type="date" name="data_inicio" id="data_inicio" value="{{ request.args.get('data_inicio', '') }}">

    <label for="data_fim">AtÃ©:</label>
    <input type="date" name="data_fim" id="data_fim" value="{{ request.args.get('data_fim', '') }}">

    <button type="submit">Filtrar</button>
  </form>

  <!-- Tabela de movimentaÃ§Ãµes -->
  <div class="table-container">
    
  <table>
    <thead>
      <tr>
        <th>Protocolo</th>
        <th>DescriÃ§Ã£o</th>
        <th>DestinatÃ¡rio</th>
        <th>UsuÃ¡rio</th>
        <th>Tipo</th>
        <th>Data</th>
        <th>Status</th>
        <th>HistÃ³rico</th>
      </tr>
    </thead>

   <tbody>
      {% if movements and movements|length > 0 %}
        {% for item in movements %}
        <tr>
          <td>{{ item.protocol }}</td>
          <td>{{ item.description }}</td>
          <td>{{ item.destinatario }}</td>
          <td>
            {% if item.usuario == "admin" %}
              ðŸ‘‘ {{ item.usuario }}
            {% else %}
              ðŸ‘¤ {{ item.usuario }}
            {% endif %}
          </td>
          <td>
            {% if item.tipo == "Entrada" %}
              ðŸ“¥ {{ item.tipo }}
            {% elif item.tipo == "SaÃ­da" %}
              ðŸ“¤ {{ item.tipo }}
            {% else %}
              {{ item.tipo }}
            {% endif %}
          </td>
          <td>
            {% if item.data %}
              {{ item.data.strftime('%d/%m/%Y') }}
            {% else %}
              -
            {% endif %}
          </td>
          <td>
            {% if item.status == "Finalizado" %}
              <span style="color:green;">âœ”</span> {{ item.status }}
            {% else %}
              {{ item.status }}
            {% endif %}
          </td>
          <td>
            <a href="{{ url_for('item_history', protocol=item.protocol) }}" class="btn-info" target="_blank">
              HistÃ³rico
            </a>
          </td>
        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="6" style="text-align:center; color:gray;">
            Nenhum dado exibido. Use os filtros acima.
          </td>
        </tr>
      {% endif %}
    </tbody>

  </table>
</div>

</section>
{% endblock %}
