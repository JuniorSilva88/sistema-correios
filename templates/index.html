<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Correios</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<header>
    <h1>Sistema de Correios</h1>
</header>

<nav>
    <a href="{{ url_for('index') }}">Dashboard</a>
    <a href="{{ url_for('new_item') }}">Cadastrar Novo Item</a>
    <a href="{{ url_for('report') }}">Gerar Relatório</a>
</nav>

<main>
    {% if page == "dashboard" %}
        <section>
            <h2>Itens cadastrados</h2>
            {% if items and items|length > 0 %}
            <table>
                <tr>
                    <th>Protocolo</th>
                    <th>Descrição</th>
                    <th>Status</th>
                    <th>Remetente</th>
                    <th>Destinatário</th>
                    <th>Fechamento</th>
                    <th>Ações</th>
                </tr>
                {% for item in items %}
                <tr>
                    <td>{{ item.protocol }}</td>
                    <td>{{ item.description }}</td>
                    <td>{{ item.status }}</td>
                    <td>{{ item.sender }}</td>
                    <td>{{ item.recipient }}</td>
                    <td>{{ item.closed }}</td>
                    <td>
                        <a class="btn" href="{{ url_for('movements', protocol=item.protocol) }}">Movimentações</a>
                        <a class="btn" href="{{ url_for('exit_item', protocol=item.protocol) }}">Registrar Saída</a>
                    </td>
                </tr>
                {% endfor %}
            </table>
            {% else %}
                <p class="muted">Nenhum item cadastrado ainda.</p>
            {% endif %}
        </section>
    {% elif page == "new_item" %}
        <section>
            <h2>Cadastrar novo item</h2>
            <form method="post">
                <div class="field">
                    <label>Remetente</label>
                    <input type="text" name="sender" placeholder="Ex: Seção 1" required>
                </div>
                <div class="field">
                    <label>Destinatário</label>
                    <input type="text" name="recipient" placeholder="Ex: Seção 5" required>
                </div>
                <div class="field">
                    <label>Descrição</label>
                    <input type="text" name="description" placeholder="Ex: Documento Oficial" required>
                </div>
                <div class="field">
                    <label>Tipo do item</label>
                    <select name="item_type">
                        <option>Documento</option>
                        <option>Pacote</option>
                    </select>
                </div>
                <div class="actions">
                    <button type="submit">Cadastrar</button>
                    <a class="btn" href="{{ url_for('index') }}">Cancelar</a>
                </div>
            </form>
        </section>
    {% elif page == "movements" %}
        <section>
            {% if item %}
                <h2>Movimentações do item {{ item.protocol }}</h2>
                <p><strong>Descrição:</strong> {{ item.description }}</p>
                <p><strong>Status:</strong> {{ item.status }}</p>
                <p><strong>Remetente:</strong> {{ item.sender }} | <strong>Destinatário:</strong> {{ item.recipient }}</p>
                <p><strong>Fechamento:</strong> {{ item.closed }}</p>

                {% if moves and moves|length > 0 %}
                <table>
                    <tr>
                        <th>Tipo</th>
                        <th>Local</th>
                        <th>Nota</th>
                        <th>Data</th>
                    </tr>
                    {% for m in moves %}
                    <tr>
                        <td>{{ m.type }}</td>
                        <td>{{ m.location }}</td>
                        <td>{{ m.note }}</td>
                        <td>{{ m.created_at }}</td>
                    </tr>
                    {% endfor %}
                </table>
                {% else %}
                    <p class="muted">Nenhuma movimentação registrada.</p>
                {% endif %}
                <div class="actions">
                    <a class="btn" href="{{ url_for('exit_item', protocol=item.protocol) }}">Registrar Saída</a>
                    <a class="btn" href="{{ url_for('index') }}">Voltar ao Dashboard</a>
                </div>
            {% else %}
                <h2>Item não encontrado</h2>
                <p>Verifique o protocolo informado.</p>
                <a class="btn" href="{{ url_for('index') }}">Voltar</a>
            {% endif %}
        </section>
    {% elif page == "exit_item" %}
        <section>
            {% if item %}
                <h2>Registrar saída do item {{ item.protocol }}</h2>
                <form method="post">
                    <div class="field">
                        <label>Local</label>
                        <input type="text" name="location" placeholder="Ex: Portaria">
                    </div>
                    <div class="field">
                        <label>Nota</label>
                        <input type="text" name="note" placeholder="Observações (opcional)">
                    </div>
                    <div class="actions">
                        <button type="submit">Registrar Saída</button>
                        <a class="btn" href="{{ url_for('movements', protocol=item.protocol) }}">Voltar</a>
                    </div>
                </form>
            {% else %}
                <h2>Item não encontrado</h2>
                <p>Verifique o protocolo informado.</p>
                <a class="btn" href="{{ url_for('index') }}">Voltar</a>
            {% endif %}
        </section>
    {% elif page == "report" %}
        <section>
            <h2>Gerar relatório</h2>
            <form method="post">
                <div class="field">
                    <label>Data inicial</label>
                    <input type="date" name="start_date">
                </div>
                <div class="field">
                    <label>Data final</label>
                    <input type="date" name="end_date">
                </div>
                <div class="field">
                    <label>Seção/Destinatário</label>
                    <select name="section">
                        {% for s in sections %}
                        <option value="{{ s }}">{{ s }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="field checkbox">
                    <label><input type="checkbox" name="export_csv" value="1"> Exportar em CSV</label>
                </div>
                <div class="actions">
                    <button type="submit">Gerar</button>
                    <a class="btn" href="{{ url_for('index') }}">Voltar</a>
                </div>
            </form>

            {% if items and items|length > 0 %}
            <h3>Resultado</h3>
            <table>
                <tr>
                    <th>Protocolo</th>
                    <th>Descrição</th>
                    <th>Status</th>
                    <th>Remetente</th>
                    <th>Destinatário</th>
                    <th>Fechamento</th>
                </tr>
                {% for r in items %}
                <tr>
                    <td>{{ r.protocol }}</td>
                    <td>{{ r.description }}</td>
                    <td>{{ r.status }}</td>
                    <td>{{ r.sender }}</td>
                    <td>{{ r.recipient }}</td>
                    <td>{{ r.closed }}</td>
                </tr>
                {% endfor %}
            </table>
            {% endif %}
        </section>
    {% endif %}
</main>

<footer>
    <p>&copy; 2025 Sistema de Correios</p>
</footer>
</body>
</html>
